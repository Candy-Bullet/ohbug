!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ohbug=t()}(this,function(){"use strict";const e="uncaughtError",t="resourceError",n="grammarError",o="promiseError",r="ajaxError",i="fetchError";function s(){const e=new Date;let t={time:`${e.getFullYear()}年${e.getMonth()+1}月${e.getDate()}日${e.getHours()}时${e.getMinutes()}分${e.getSeconds()}秒`,userAgent:window.navigator.userAgent,url:window.location.href,title:document.title};return window.$OhbugConfig&&window.$OhbugConfig.others&&(t={...t,...window.$OhbugConfig.others}),t}let a;function u(e){const t="error",n="background: #d9634d; color: #fff; padding: 2px 4px; border-radius: 2px";console.log(`%c${t}`,n,e)}function d(e){try{window.$OhbugConfig&&window.$OhbugConfig.report&&window.$OhbugConfig.report(e)}catch(e){u(`发送日志失败 errorInfo:${e}`)}}const c=/^(https?:\/\/)?(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(.+)?$/.test(window.location.host)||window.location.host.indexOf("localhost")>-1,h=[];function p(e){u(e),h.push({...s(),...e});const t=(n=(()=>{try{u(h),c?window.$OhbugConfig&&window.$OhbugConfig.enabledDev&&d(h):d(h)}catch(e){u(`日志上报出现异常错误 errorInfo:${e}`)}}),o=window.$OhbugConfig&&window.$OhbugConfig.delay||2e3,function(){const e=this,t=arguments;a&&clearTimeout(a),a=setTimeout(()=>{n.apply(e,t)},o)});var n,o;h.length&&t()}function l({type:r,e:i}){try{if("default"===r){const{message:o,filename:r,lineno:s,colno:a,error:u}=i;if(o){if(u){p({type:e,desc:{message:o,filename:r,row:s,col:a,error:u.stack||u}})}}else{const e=i.target||i.srcElement;let o=i.target||i.srcElement;if(e){const{outerHTML:n}=e,r=function(){const e=[];for(let t=0;o&&o.nodeType===Node.ELEMENT_NODE&&o.nodeType!==Node.DOCUMENT_TYPE_NODE;o=o.previousSibling)t&&e.push(o),t+=1;return i&&i.path.reverse().map(t=>(t.localName||"")+(t.id?`#${t.id}`:"")+(t.className?`.${t.className}`:"")+(t.outerHTML===n?`:nth-child(${e.length})`:"")).filter(e=>e).join(" > ")}();p({type:t,desc:{outerHTML:n,src:e&&e.src,tagName:e&&e.tagName,id:e&&e.id,className:e&&e.className,name:e&&e.name,type:e&&e.type,selector:r,timeStamp:i.timeStamp}})}else if("string"==typeof i){p({type:n,desc:i})}}}else if("promise"===r){p({type:o,desc:{message:i.reason.message||i.reason,error:i.reason.stack||i.reason}})}return!1}catch(e){p(e)}}function f(){window.addEventListener&&window.addEventListener("error",e=>{l({type:"default",e:e})},!0),window.addEventListener&&window.addEventListener("unhandledrejection",e=>{e.preventDefault(),l({type:"promise",e:e})},!0),function(){window.XMLHttpRequest&&{reqUrl:"",reqMethod:"",xhrOpen:window.XMLHttpRequest.prototype.open,xhrSend:window.XMLHttpRequest.prototype.send,init(){const e=this;window.XMLHttpRequest.prototype.open=function(){e.reqUrl=arguments[1],e.reqMethod=arguments[0],e.xhrOpen.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){const t={...s(),type:r,req:{url:e.reqUrl,method:e.reqMethod,data:arguments[0]||{}},res:{status:0,statusText:"",response:null}};this.addEventListener("readystatechange",function(){4===this.readyState&&(t.res.response=this.response,t.res.status=this.status,t.res.statusText=this.statusText,(!this.status||this.status>=400)&&p(t))}),e.xhrSend.apply(this,arguments)}}}.init();if(window.fetch){const e={backup:window.fetch,init(){window.fetch=function(t,n){return e.backup.apply(this,arguments).then(e=>{const o={...s(),type:i,req:{url:t,method:n&&n.method||"GET",data:n&&n.body||{}},res:{status:e.status,statusText:e.statusText}};return(!e.status||e.status>=400)&&p(o),e}).catch(e=>{p(e)})}}};e.init()}}()}function w(){}return w.init=function(e){window?(window.$OhbugAuth=!0,window.$OhbugConfig||(window.$OhbugConfig={delay:2e3,enabledDev:!1}),e&&(window.$OhbugConfig={...window.$OhbugConfig,...e}),window.$OhbugAuth&&f()):console.error("检测到当前环境不支持 Ohbug！")},w.caughtError=((e,t,n)=>{if(window.$OhbugAuth){if("function"==typeof n.value)return{...n,value(){try{return n.value&&n.value.apply(this,arguments)}catch(e){throw p({type:"caughtError",desc:{method:t,params:arguments,error:e.stack||e}}),e}}};if("function"==typeof n.initializer)return{enumerable:!0,configurable:!0,get(){return n.initializer&&n.initializer.apply(this)}}}else console.error("检测到未执行 Ohbug.init()")}),w.reportError=(e=>{window.$OhbugAuth?p({type:"reportError",desc:e}):console.error("检测到未执行 Ohbug.init()")}),w});
